<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>App Catalog | Yantr</title>
    <meta name="description" content="Browse 100+ self-hosted apps you can self-host with Docker using Yantr. Search and filter by tag to find the right app for your homelab." />
    <meta name="theme-color" content="#ffffff" />
    <link rel="canonical" href="https://yantr.org/catalog/" />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://yantr.org/catalog/" />
    <meta property="og:title" content="App Catalog | Yantr" />
    <meta property="og:description" content="Browse 100+ self-hosted apps available in Yantr." />

    <link rel="stylesheet" href="../tailwind.css" />
    <style>
      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.1;
          transform: scale(0.8);
        }
        50% {
          opacity: 0.4;
          transform: scale(1.1);
        }
      }
      .star-icon {
        position: absolute;
        animation: twinkle 4s infinite ease-in-out;
        opacity: 0.1;
        filter: grayscale(100%);
        transition: all 0.3s;
        pointer-events: auto;
      }
      .star-icon:hover {
        opacity: 1 !important;
        filter: grayscale(0%);
        transform: scale(1.1) !important;
        z-index: 20;
        animation-play-state: paused;
        background: rgba(255, 255, 255, 0.9);
        box-shadow:
          0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
      }
      .tag-btn.active {
        background-color: #000;
        color: #fff;
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in-up {
        animation: fadeInUp 0.65s ease-out forwards;
      }
    </style>
  </head>

  <body class="bg-white text-black font-mono antialiased selection:bg-black selection:text-white relative">
    <div id="catalog-stars" class="absolute top-0 left-0 w-full overflow-hidden -z-10 pointer-events-none" style="height: 100%"></div>
    <main class="w-full px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
      <div class="w-full max-w-6xl mx-auto">

        <!-- Header -->
        <div class="mb-10 animate-fade-in-up">
          <a href="../index.html" class="inline-flex items-center gap-2 text-sm text-gray-500 hover:text-black transition-colors mb-6">
            <span>←</span>
            <span>Back to home</span>
          </a>
          <div class="flex flex-wrap items-end justify-between gap-3 border-b border-gray-200 pb-4">
            <div>
              <p class="text-[10px] uppercase tracking-[0.18em] text-gray-400 font-semibold mb-2">Discover</p>
              <h1 class="text-3xl sm:text-4xl font-bold font-sans">App Catalog</h1>
            </div>
            <p class="text-sm text-gray-500" id="app-count">Loading apps…</p>
          </div>
        </div>

        <div class="rounded-2xl border border-gray-200 bg-white/95 backdrop-blur p-4 sm:p-5 mb-8 animate-fade-in-up">
          <!-- Search -->
          <div class="mb-5">
            <input
              id="search"
              type="search"
              placeholder="Search apps…"
              autocomplete="off"
              class="w-full sm:w-96 px-4 py-2.5 text-sm border border-gray-300 bg-white text-black placeholder-gray-400 focus:outline-none focus:border-black transition-colors"
            />
          </div>

          <!-- Category filters -->
          <div id="tag-filters" class="flex flex-wrap gap-2"></div>
        </div>

        <!-- App grid -->
        <div id="app-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5"></div>

        <!-- Empty state -->
        <p id="empty-state" class="hidden text-sm text-gray-400 mt-8 border border-dashed border-gray-300 rounded-xl p-6 bg-white">
          No apps match your filter.
        </p>

      </div>
    </main>

    <script>
      let allApps = [];
      let activeTag = 'all';
      let searchQuery = '';

      function logoUrl(app) {
        if (!app.logo) {
          return `https://ui-avatars.com/api/?name=${encodeURIComponent(app.name || app.id)}&background=random&color=fff&bold=true`;
        }
        return app.logo.startsWith('http') ? app.logo : `https://ipfs.io/ipfs/${app.logo}`;
      }

      function renderTags(categories) {
        const container = document.getElementById('tag-filters');
        const all = ['all', ...categories];
        container.innerHTML = all.map(tag => `
          <button
            data-tag="${tag}"
            class="tag-btn text-[10px] uppercase tracking-wider px-3 py-1.5 border border-gray-300 hover:border-black transition-colors rounded-md ${tag === 'all' ? 'active' : ''}"
          >${tag === 'all' ? 'All' : tag}</button>
        `).join('');

        container.addEventListener('click', (e) => {
          const btn = e.target.closest('.tag-btn');
          if (!btn) return;
          activeTag = btn.dataset.tag;
          container.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderGrid();
        });
      }

      function renderGrid() {
        const grid = document.getElementById('app-grid');
        const empty = document.getElementById('empty-state');
        const q = searchQuery.toLowerCase();

        const filtered = allApps.filter(app => {
          const matchesTag = activeTag === 'all' || (app.tags || []).includes(activeTag);
          const matchesSearch = !q || app.name.toLowerCase().includes(q) || (app.short_description || app.description || '').toLowerCase().includes(q) || (app.tags || []).some(t => t.includes(q));
          return matchesTag && matchesSearch;
        });

        document.getElementById('app-count').textContent = `${filtered.length} of ${allApps.length} apps`;

        if (filtered.length === 0) {
          grid.innerHTML = '';
          empty.classList.remove('hidden');
          return;
        }

        empty.classList.add('hidden');
        grid.innerHTML = filtered.map(app => {
          const tags = (app.tags || []).slice(0, 4).map(t => `
            <span class="text-[9px] uppercase tracking-wider px-2 py-0.5 border border-gray-200 text-gray-500 rounded">${t}</span>
          `).join('');
          const desc = app.short_description || app.description || 'No description available.';

          return `
            <a
              href="../apps/${app.id}/"
              class="group flex flex-col gap-3 rounded-2xl border border-gray-200 p-5 bg-white hover:border-black/30 hover:shadow-xl hover:-translate-y-1 transition-all duration-300"
            >
              <div class="flex items-center gap-4">
                <img src="${logoUrl(app)}" alt="${app.name} logo" class="w-12 h-12 rounded-xl border border-gray-200 object-cover shrink-0 bg-gray-50" loading="lazy" />
                <div class="min-w-0">
                  <p class="font-semibold text-sm truncate">${app.name}</p>
                  <p class="text-xs text-gray-500 mt-0.5 line-clamp-2 leading-relaxed">${desc}</p>
                </div>
              </div>
              ${tags ? `<div class="flex flex-wrap gap-1.5">${tags}</div>` : ''}
            </a>
          `;
        }).join('');
      }

      document.getElementById('search').addEventListener('input', (e) => {
        searchQuery = e.target.value;
        renderGrid();
      });

      function initCatalogStars(apps) {
        const container = document.getElementById('catalog-stars');
        if (!container || !Array.isArray(apps) || apps.length === 0) return;

        const stars = apps.filter(app => app.logo);
        if (stars.length === 0) return;

        const selected = [...stars].sort(() => 0.5 - Math.random()).slice(0, Math.min(48, stars.length));
        const docHeight = document.documentElement.scrollHeight;
        container.style.height = docHeight + 'px';

        selected.forEach((app) => {
          const logo = logoUrl(app);
          const el = document.createElement('div');
          el.className = 'star-icon absolute flex items-center gap-2 px-2.5 py-1 rounded-full bg-white/70 backdrop-blur-md shadow-sm border border-white/50';
          el.style.left = Math.floor(Math.random() * 88) + 2 + '%';
          el.style.top = Math.floor(Math.random() * docHeight) + 'px';
          el.style.animationDelay = Math.random() * 5 + 's';
          el.style.animationDuration = Math.random() * 3 + 3 + 's';
          const size = Math.floor(Math.random() * 8) + 14;

          el.innerHTML = `
            <img src="${logo}" style="width:${size}px;height:${size}px;" class="object-contain shrink-0" alt="${app.name}" />
            <span class="text-[11px] font-semibold text-gray-700 whitespace-nowrap">${app.name}</span>
          `;
          container.appendChild(el);
        });
      }

      fetch('../apps.json')
        .then(r => r.json())
        .then(data => {
          allApps = (data.apps || []).sort((a, b) => a.name.localeCompare(b.name));
          renderTags(data.meta?.tags || []);
          renderGrid();
          initCatalogStars(allApps);
        })
        .catch(() => {
          document.getElementById('app-count').textContent = 'Failed to load apps.';
        });
    </script>
  </body>
</html>
